var produits = {
		property : 43,
        "beurre_alu" : {"code":"100501", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"beurre_campagne" : {"code":"503", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"maredsous" : {"code":"441", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"kiri" : {"code":"479", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},	
		"creme_fraiche" : {"code":"16402", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"lait_demi_ecreme" : {"code":"1986", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"oeufs" : {"code":"100153", "Lait":false, "Gluten":false, "Oeuf":true, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"brownie_chocolat" : {"code":"541427", "Lait":true, "Gluten":true, "Oeuf":true, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":true, "Moutarde":false, 
					"Sesame":true, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":true},
		"frangipane" : {"code":"548046", "Lait":true, "Gluten":true, "Oeuf":true, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":true, "F. a coque":true, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":true},		
		"flan_vanille" : {"code":"1607", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"mascarpone" : {"code":"187238", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},			
		"pudding_vanille" : {"code":"1473", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"chausson_pommes" : {"code":"349147", "Lait":false, "Gluten":true, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},			
		"eclair" : {"code":"21973", "Lait":false, "Gluten":true, "Oeuf":true, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"compote_peches" : {"code":"542222", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},			
		"cake_abricot" : {"code":"531293", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},			
		"gouda_jeune_tranches" : {"code":"102001", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},			
		"camembert_8p" : {"code":"615", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},			
		"emmental_rape" : {"code":"180", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},			
		"chair_moule" : {"code":"21844", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"thon" : {"code":"17221", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":true, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"saumon_tranche" : {"code":"5190", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":true, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"crevette" : {"code":"20791", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":true, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"margarine_liquide" : {"code":"1030", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"demi_peches" : {"code":"23060", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false}, 
		"croquettes" : {"code":"387723", "Lait":false, "Gluten":true, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false}, 
		"sauce_aigre_douce" : {"code":"5000", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":true, "Sulfite":false, "Soja":false}, 					
		"roux_brun" : {"code":"4319", "Lait":false, "Gluten":true, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},	
		"roux_blanc" : {"code":"4320", "Lait":false, "Gluten":true, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"mayonnaise" : {"code":"4998", "Lait":false, "Gluten":false, "Oeuf":true, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":true, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"sauce_pickles" : {"code":"18379", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":true, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"puree" : {"code":"15000", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":true, "Soja":false},
		"pois_casse" : {"code":"4571", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"ble_10" : {"code":"604504", "Lait":false, "Gluten":true, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"ble_5" : {"code":"604506", "Lait":false, "Gluten":true, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},	
		"sucrem_nova" : {"code":"541909", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"sorbet_citron" : {"code":"360091", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"sorbet_framboise" : {"code":"360457", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"sorbet_poire" : {"code":"360451", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"sorbet_passion" : {"code":"360456", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},
		"mini_eclair" : {"code":"340037", "Lait":true, "Gluten":true, "Oeuf":true, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":true},			
		"yaourt_demi_ecreme_fruits"	: {"code":"100100", "Lait":true, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false},		
		"madeleine" : {"code":"16509", "Lait":false, "Gluten":true, "Oeuf":true, "Poisson":false, "Crustace":false, 
					"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
					"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false}			
		
};
var prodTest = new Object();
var Allergenes = ["Lait", "Gluten", "Oeuf", "Poisson", "Crustace", "Mollusque", "Arachide",
				"F. a coque" , "Moutarde", "Sesame", "Lupin", "Celeri", "Sulfite", "Soja"];
//var produits = new Object();
/*
*    CODE DE REFERENCE : 7 chiffres max pour mon tableau, si + ==> a voir pour la taille
*/
function creeTab(product) {
	
	//readProduit();
    var tabl = "<table id=cssTableM><tr><td>Articles-Ingredients </td><td> Code ref </td><td> Quantite </td>";
    for (var i = 1; i < Allergenes.length+1; i++) {
        tabl += "<td>" + " " + i + ") " +Allergenes[i-1] + "</td>";
    }
	tabl += "</tr>"
  
	for (var i = 0; i < 15; i++) {	
		var line;
		line = "<form id=formuChoix> <input list=browsers onfocusout=test(this) name=browser style=border:none class=produit id=prod"+ i +"> <datalist id=browsers>";
		//line += optionAdd(line);
		for(var prod in product) {
			line += "<option value=" + prod + ">";
		}
		/*line += "<option value=madeleine>";
		line += "<option value=kiri>";
		line += "<option value=maredsous>";
		line += "<option value=oeufs>";
		line += "<option value=frangipane>";
		line += "<option value=mascarpone>";
		line += "<option value=eclair>";
		line += "<option value=thon>";
		line += "<option value=crevette>";
		line += "<option value=mayonnaise>";
		line += "<option value=croquettes>";
		line += "<option value=puree>";*/
		line += "</datalist></form>";
		//tabl += "<td><form id=form autocomplete=on><input type=text style=border:none class=produit id=prod"+ i +"></td><td id=ref" + i + "></form></td><td><input type=text style=border:none id=quantite name=produit></td>";
		//tabl += "<td><input type=text onchange=autoselect() style=border:none class=produit id=prod"+ i +"></td><td id=ref" + i + "></td><td><input type=text style=border:none id=quantite name=produit></td>";
		//tabl += "<td><input type=text onchange=autoselect() oninput=sayHello() style=border:none class=produit id=prod"+ i +"></td><td id=ref" + i + "></td><td><input type=text style=border:none id=quantite name=produit></td>";
		tabl += "<td>"+ line +"</td><td id=ref" + i + "></td><td><input type=text style=border:none id=quantite name=produit></td>";
		for (var j = 0; j < 14; j++){
		  var k = "" + j;
		  tabl += "<td id=" + i+k + "></td>";
		}
		tabl += "</tr>";
	}
	tabl += "</table>";
    
	document.getElementById("tabl").innerHTML = tabl;
}

function optionAdd(line){
	for(var prod in produits) {
		line += "<option value=" + prod + ">";
	}
}
/*
function creeTab() {

    var tabl = "<table id=cssTableM><tr><td>Articles-Ingredients </td><td> Code ref </td><td> Quantite </td>";
    for (var i = 1; i < Allergenes.length+1; i++) {
        tabl += "<td>" + " " + i + ") " +Allergenes[i-1] + "</td>";
    }
	tabl += "</tr>"
  
	for (var i = 0; i < 23; i++) {
		//tabl += "<td><form id=form autocomplete=on><input type=text style=border:none class=produit id=prod"+ i +"></td><td id=ref" + i + "></form></td><td><input type=text style=border:none id=quantite name=produit></td>";
		tabl += "<td><input type=text onchange=autoselect() onfocusout=test(this) style=border:none class=produit id=prod"+ i +"></td><td id=ref" + i + "></td><td><input type=text style=border:none id=quantite name=produit></td>";
		for (var j = 0; j < 14; j++){
		  var k = "" + j;
		  tabl += "<td id=" + i+k + "></td>";
		}
		tabl += "</tr>";
	}
	tabl += "</table>";
    
	document.getElementById("tabl").innerHTML = tabl;
}*/
function lol() {
	window.alert('coucou toi tu ...');
}
function test(t){
	for (var i=0; i< 14;i++){
		var y = t.id.substr(-1) + i;
		document.getElementById(y).innerHTML = "";
		document.getElementById("ref" + t.id.substr(-1)).innerHTML = "";
	}
	var t2 = (t.value).toLowerCase();
  //console.log(produits[t2]);
  //if(produits[t2] == undefined){
  if(prodTest[t2] == undefined){
    console.log("erreur");
  }else{
	  //document.getElementById("ref" + t.id.substr(-1)).innerHTML = produits[t2].code;
	  document.getElementById("ref" + t.id.substr(-1)).innerHTML = prodTest[t2].code;
    for(var i = 0; i < Allergenes.length; i++){
      var tab = Allergenes[i];
       //if(produits[t2][tab]){
       if(prodTest[t2][tab]){
       var y = t.id.substr(-1) + i;
	   
        document.getElementById(y).innerHTML = "X";
      } 
    }
  }
}
function writeJSON() {
	var filename = "savedProduits.txt";
	const aElement    = document.createElement("a");
	var texte = JSON.stringify(produits);
	aElement.href     = "data:text/plain;charset=UTF-8," + encodeURIComponent(texte);
	aElement.target   = "_self";
	aElement.download = filename;
	document.body.appendChild(aElement);
	aElement.click();
	document.body.removeChild(aElement);
}
function ajout() {
	//alert('element ajoute !');
	var nom = document.getElementById("newP").value; 
	var cod = document.getElementById("newC").value; 
	if(cod == "") {
		window.alert('Code de référence vide');
	}
	if(nom == "") {
		window.alert('Nouveau produit vide');
	}
	if(nom != "" && cod != ""){
		var laitB = document.getElementById("lait").checked;
		var glutenB = document.getElementById("gluten").checked;
		var oeufB = document.getElementById("oeuf").checked;
		var poissonB = document.getElementById("poisson").checked;
		var crustaceB = document.getElementById("crustace").checked;
		var mollusqueB = document.getElementById("mollusque").checked;
		var arachideB = document.getElementById("arachide").checked;
		var coqueB = document.getElementById("f. a coque").checked;
		var moutardeB = document.getElementById("moutarde").checked;
		var sesameB = document.getElementById("sesame").checked;
		var lupinB = document.getElementById("lupin").checked;
		var celeriB = document.getElementById("celeri").checked;
		var sulfiteB = document.getElementById("sulfite").checked;
		var sojaB = document.getElementById("soja").checked;
		//String nom2 = nom;
		if (produits[nom] == null){
			produits.property = produits.property +1;
		}
		produits[nom] = {"code":cod, "Lait":laitB, "Gluten":glutenB, "Oeuf":oeufB, "Poisson":poissonB, "Crustace":crustaceB, 
						"Mollusque":mollusqueB, "Arachide":arachideB, "F. a coque":coqueB, "Moutarde":moutardeB, 
						"Sesame":sesameB, "Lupin":lupinB, "Celeri":celeriB, "Sulfite":sulfiteB, "Soja":sojaB};
		//produits["ananas"] = {"code":"1607", "Lait":false, "Gluten":false, "Oeuf":false, "Poisson":false, "Crustace":false, 
		//				"Mollusque":false, "Arachide":false, "F. a coque":false, "Moutarde":false, 
		//				"Sesame":false, "Lupin":false, "Celeri":false, "Sulfite":false, "Soja":false};
		
		//produits.property = produits.property +1; // faut checker que si nom existe alors on fait pas
		var okAjout = "Ajout " + nom + " effectué";
		document.getElementById("verifAjout").value = okAjout;
		//window.alert('Ajout effectue');
		
		/*var filename = "savedProduits.txt";
		const aElement    = document.createElement("a");
		var texte = JSON.stringify(produits);
		aElement.href     = "data:text/plain;charset=UTF-8," + encodeURIComponent(texte);
		aElement.target   = "_self";
		aElement.download = filename;
		document.body.appendChild(aElement);
		aElement.click();
		document.body.removeChild(aElement);*/
	}
	printProduit();
}
function supprimer() {
	var nom = document.getElementById("newP").value; 
	if(nom == "") {
		window.alert('Nouveau produit vide');
	}
	if(nom != ""){
		delete produits[nom];
		produits.property = produits.property -1;
		writeJSON();
		printProduit();
		window.alert('Produit supprimé et fichier edité');
	}
}
function printProduit() {
	//ajout();
	//var produitExist = "<table id=TableProduit><tr><td> Produits </td><td> Code ref </td>";
	//produits.sort();
	var produitExist = "<table id=TableProduit>";
	var cle = Object.keys(produits);
	for(var i=1; i<produits.property+1; i++) {
		var code = produits[cle[i]].code;
		produitExist += "<tr><td>"+ cle[i] +"</td><td> "+ code + " </td></tr>";
	}
	
	produitExist += "</tr></table>";
	document.getElementById("tableauP").innerHTML = produitExist;
}

/*function readProduit() {
	var myFile = = = type File();
	var reader = new FileReader();
	reader.onload = function(e) {
	var text = reader.result;
}
}*/
function readProduit() {
	//window.alert("bien valide");
  var myFile = document.getElementById("myFile").files[0];

  var fileReader = new FileReader();
  fileReader.onload = function(fileLoadedEvent){
	  var textFromFileLoaded = fileLoadedEvent.target.result;
	  //document.getElementById("inputTextToSave").value = textFromFileLoaded;
	  window.alert("Fichier chargé");
	  prodTest = JSON.parse(textFromFileLoaded);
	  produits = prodTest;
	  //produits = copy(prodTest);
	  console.log(prodTest);
  };

  fileReader.readAsText(myFile, "UTF-8");	
  creeTab(produits);
  //document.getElementById("readText").style.display = "none";
}
function copy(mainObj) {
  let objCopy = {}; // objCopy will store a copy of the mainObj
  let key;

  for (key in mainObj) {
    objCopy[key] = mainObj[key]; // copies each property to the objCopy object
  }
  return objCopy;
}
//JSON.stringify()  ==> tableau vers JSON a svgder
// JSON.parse()  ==> JSON vers Object
